version: '3.8'

services:
  kibana:
    build:
      context: ./kibana
    container_name: kibana-central-frontend
    restart: always
    environment:
      # Redirect Kibana to query the distributed Elasticsearch backend
      # For a decentralized setup, list your primary ES node here or use CCS
      ELASTICSEARCH_HOSTS: '["https://<SERVER_1_IP_HERE>:9200"]'
      ELASTICSEARCH_USERNAME: kibana_system
      ELASTICSEARCH_PASSWORD: ${KIBANA_PASSWORD}
      # Optimization: Boost Node.js memory for heavy dashboards
      NODE_OPTIONS: "--max-old-space-size=8192" 
    ports:
      - "5601:5601"
    deploy:
      resources:
        limits:
          # Allowing Kibana to use significant resources for dashboard rendering
          memory: 12G 
          cpus: '4.0'
    networks:
      - elk-net

networks:
  elk-net:
    driver: bridge
